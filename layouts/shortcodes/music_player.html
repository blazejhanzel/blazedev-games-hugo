<style>
  .player_container {
    margin-left: auto;
    margin-right: auto;
    width: calc(80% + 32px);
  }

  .player {
    background: #292c31;
    box-shadow: 0 4px 15px rgba(0,0,0,0.4);
    margin-left: 16px;
    margin-right: 16px;
  }

  .info {
    background: #343941;
    padding: 8px 16px 8px 16px;
  }

  .title {
    font-size: 16px;
    line-height: 1;
    margin-bottom: 6px;
  }

  .subtitle {
    font-size: 12px;
    color: #aaa;
    line-height: 1;
  }

  .controls {
    display: flex;
    align-items: center;
    gap: 10px;
    padding-left: 8px;
    padding-right: 16px;
  }

  .play-btn {
    width: 40px;
    height: 40px;
    border: none;
    border-radius: 50%;
    background: transparent;
    color: white;
    font-size: 18px;
    cursor: pointer;
  }

  .progress {
    flex: 1;
    height: 8px;
    background: #444;
    overflow: hidden;
    cursor: pointer;
  }

  .progress-bar {
    height: 100%;
    width: 0%;
    background: #fff;
  }

  .time, .time-end {
    font-size: 12px;
    color: #bbb;
    min-width: 40px;
    text-align: right;
  }
</style>

<div class="player_container">
  <div class="player">
    <div class="info">
      <div class="title"><b>{{ .Get "track_number" }}.</b> {{ .Get "title" }}</div>
      <div class="subtitle">{{ .Get "author" }} — {{ .Get "year" }}</div>
    </div>

    <div class="controls">
      <button class="play-btn" id="play-btn-{{ .Get "src" | urlize }}" src="{{ .Get "src" }}">▶</button>
      <div class="time" id="time-{{ .Get "src" | urlize }}" src="{{ .Get "src" }}">0:00</div>
      <div class="progress" id="progress-{{ .Get "src" | urlize }}" src="{{ .Get "src" }}"><div class="progress-bar" id="progress-bar-{{ .Get "src" | urlize }}" src="{{ .Get "src" }}"></div></div>
      <div class="time-end" id="time-end-{{ .Get "src" | urlize }}" src="{{ .Get "src" }}">0:00</div>
    </div>

    <audio class="audio" id="audio-{{ .Get "src" | urlize }}" src="{{ .Get "src" }}"></audio>
  </div>
</div>

<script>
  (function() {
    const source = '{{ .Get "src" | urlize }}';
    const audio = document.getElementById("audio-" + source);
    const playBtn = document.getElementById("play-btn-" + source);
    const progress = document.getElementById("progress-" + source);
    const progressBar = document.getElementById("progress-bar-" + source);
    const time = document.getElementById("time-" + source);
    const timeEnd = document.getElementById("time-end-" + source);

    playBtn.addEventListener("click", () => {
      if (audio.paused) {
        document.querySelectorAll(".audio").forEach(a => {
          if (!a.paused && a !== audio) {
            a.pause();
            const otherBtn = document.getElementById("play-btn-" + a.id.replace("audio-", ""));
            if (otherBtn) otherBtn.textContent = "▶";
          }
        });

        audio.play();
        playBtn.textContent = "⏸";
      } else {
        audio.pause();
        playBtn.textContent = "▶";
      }
    });

    audio.addEventListener("timeupdate", () => {
      const percent = (audio.currentTime / audio.duration) * 100;
      progressBar.style.width = percent + "%";

      let minutes = Math.floor(audio.currentTime / 60);
      let seconds = Math.floor(audio.currentTime % 60);
      if (seconds < 10) seconds = "0" + seconds;
      time.textContent = `${minutes}:${seconds}`;
      timeEnd.textContent = `${Math.floor(audio.duration / 60)}:${Math.floor(audio.duration % 60).toString().padStart(2, '0')}`;
    });

    progress.addEventListener("click", (e) => {
      const rect = progress.getBoundingClientRect();
      const percent = (e.clientX - rect.left) / rect.width;
      audio.currentTime = percent * audio.duration;
    });
    
    audio.addEventListener("loadedmetadata", () => {
      if (!isNaN(audio.duration)) {
        timeEnd.textContent =
          `${Math.floor(audio.duration / 60)}:${Math.floor(audio.duration % 60).toString().padStart(2, '0')}`;
      }
    });
  })();
</script>